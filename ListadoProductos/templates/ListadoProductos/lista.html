<style>

</style>
{% extends "Home/base.html" %}
{% block title %} Listado de productos {% endblock %}
{% load static %}
{% block content %}
<div class="row">
  <div class="col-xs-12 section-container-spacer">
    <h1>Listado Productos</h1>
     <!-- Buscador de alimentos -->
    <input id="search" class="form-control mb-3" placeholder="alimento">
  </div>
   <!-- tabla de los productos -->
  <table class="table">
    <thead>
      <tr>
        <th scope="col">Nombre</th>
        <th scope="col" class="opcion">Fructosa</th>
        <th scope="col" class="opcion">Lactosa</th>
        <th scope="col" class="opcion">Sorbitol</th>
        <th scope="col" class="opcion">Manitol</th>
        <th scope="col" class="opcion">GOS</th>
        <th scope="col" class="opcion">Fructano</th>
        <th scope="col" class="opcion2"></th>
        <th scope="col" class="opcion">gr</th>
      </tr>
    </thead>
    
    <!-- Carga contenido de la tabla -->
    <tbody id="box">
    </tbody>
  </table>
  <script>
    const data = '{{qs_json}}'
    const rdata = JSON.parse(data.replace(/&quot;/g, '"'))
    const input = document.getElementById("search")
    let filteredArr = []

    input.addEventListener('keyup', (e) => {
      box.innerHTML = "";
      filteredArr = rdata.filter(info => info['name'].includes(e.target.value))

      if (filteredArr.length > 0) {
        filteredArr.map(info => {
          let color = "verde";
          let fructosa = info['fructosa'];
          let lactosa = info['lactosa'];
          let manitol = info['manitol'];
          let sorbitol = info['sorbitol'];
          let gos = info['gos'];
          let fructano = info['fructano'];
          let arr = [fructosa, lactosa, manitol, sorbitol, gos, gos, fructano]

          //Dibujar las celdas de colores
          arr.forEach(element => {
            if (element[0] === 'amarillo' && color === 'verde') {
              color = "amarillo";
            }
            if (element[0] === 'rojo') {
              color = "rojo";
            }
          });
          //AÃ±adir los productos a la tabla
          box.innerHTML += ` 
        <tr>
          <td id="name"><a href="${info['id']}">${info['name']}</a></td>
          <td class="${info['fructosa']} opcion" ></td>
          <td class="${info['lactosa']} opcion"></td>
          <td class="${info['manitol']} opcion"></td>
          <td class="${info['sorbitol']} opcion"></td>
          <td class="${info['gos']} opcion"></td>
          <td class="${info['fructano']} opcion"></td>
          <td class="opcion">${info['gr']} </td>
          <td class="${color} opcion2"> </td>
        </tr>`
        })
      } else {
        box.innerHTML += `<br>No hay resultados</b></br>`
      }
    })
  </script>
  {% endblock %}