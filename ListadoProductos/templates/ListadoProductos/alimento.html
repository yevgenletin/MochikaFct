

  {% extends "Home/base.html" %}
  {% block title %} Inicio {% endblock %}
  {% load static %}
  {% block content %}
  <style>
    #alert {
      display: none;
    }
  </style>

  <div class="row">
    <!--Aviso actualizacion alimento -->
    <div id="alert" class="col-xs-12 fixed-top alert alert-success alert-dismissible fade show" role="alert">
      <strong>Se actualizo el elemento</strong>
      <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <!-- Cabecera-->
    <div class="col-xs-12 section-container-spacer">
      <h1>{{ listado.name }}
        {% if user.is_authenticated %}
        
          {% if favoritos %}
          <div id="check"></div>
              <a href="{% url 'favoritos' %}"><img id="estrella" class="img-responsive fa-icon" alt="dew" src="{% static 'Home/img/cheque.png'%}"></a></h1>
          </div>
          {% endif %}
        {% endif %}
    </div>
  </div>
 
  <!--Tabla -->
  <div class="row opcion2">
    <table class="table col-xs-12">
      <thead>
        <tr>
          <th scope="col" >nombre</th>
          <th scope="col" >Bajo</th>
          <th scope="col" >Medio</th>
          <th scope="col" >Alto</th>
          </tr>
      </thead>
      <tbody>
        <tr>
          <td>Fruc</td>
          <td class="{{listado.fructosa}}"></td>
          <td class="{{listado.fructosaAmarillo}}"></td>
          <td class="{{listado.fructosaRojo }}"></td>
        </tr>
        <tr>
          <td>Lac</td>
          <td class="{{listado.lactosa}}"></td>
          <td class="{{listado.lactosaAmarillo}}"></td>
          <td class="{{listado.lactosaRojo }}"></td>
        </tr>
        <tr>
          <td>Sor</td>
          <td class="{{listado.lactosa}}"></td>
          <td class="{{listado.lactosaAmarillo}}"></td>
          <td class="{{listado.lactosaRojo }}"></td>
        </tr>
        <tr>
          <td>Man</td>
          <td class="{{listado.lactosa}}"></td>
          <td class="{{listado.lactosaAmarillo}}"></td>
          <td class="{{listado.lactosaRojo }}"></td>
        </tr>
      <tr>
        <td>GOS</td>
        <td class="{{listado.lactosa}}"></td>
        <td class="{{listado.lactosaAmarillo}}"></td>
        <td class="{{listado.lactosaRojo }}"></td>
      </tr>
      <tr>
        <td>Fru</td>
        <td class="{{listado.lactosa}}"></td>
        <td class="{{listado.lactosaAmarillo}}"></td>
        <td class="{{listado.lactosaRojo }}"></td>
      </tr>
      <tr>
        <td>gr</td>
        <td>{{listado.gr}}</td>
        <td>{{listado.grAmarillo}}</td>
        <td>{{listado.grRojo}}</td>
      </tr>
    </tbody>
  </table>
</div>
<div class="row  opcion">
  <table class="table col-xs-12">
    <thead>
      <tr>
        <th scope="col" >Nivel</th>
        <th scope="col" >Fructosa</th>
        <th scope="col" >Lactosa</th>
        <th scope="col" >Sorbitol</th>
        <th scope="col">Manitol</th>
        <th scope="col">GOS</th>
        <th scope="col">Fructano</th>
        <th scope="col" >gr</th>
      </tr>
    </thead>
       <tbody id="box">
        <tr>
          <td >Bajo</td>
          <td class="{{listado.fructosa }}" ></td>
          <td class="{{listado.lactosa}}"></td>
          <td class="{{listado.manitol}}"></td>
          <td class="{{listado.sorbitol}}"></td>
          <td class="{{listado.gos}}"></td>
          <td class="{{listado.fructano}}"></td>
          <td>{{listado.gr}}</td>
        </tr>
        <!-- Dependiendo si existe apartado lo muestra o no en la tabla -->
        {% if listado.grAmarillo != 'false' %}
            {% if listado.grAmarillo != 'False' %}
              <tr>
                <td >Medio</td>
                <td class="{{listado.fructosaAmarillo }}" ></td>
                <td class="{{listado.lactosaAmarillo}}"></td>
                <td class="{{listado.manitolAmarillo}}"></td>
                <td class="{{listado.sorbitolAmarillo}}"></td>
                <td class="{{listado.gosAmarillo}}"></td>
                <td class="{{listado.fructanoAmarillo}}"></td>
                <td>{{listado.grAmarillo}}</td>
              </tr>
            {% endif %}
        {% endif %}
        {% if listado.grRojo != 'false' %}
            {% if listado.grRojo != 'False' %}
              <tr>
                <td>Alto</td>
                <td class="{{listado.fructosaRojo }}" ></td>
                <td class="{{listado.lactosaRojo}}"></td>
                <td class="{{listado.manitolRojo}}"></td>
                <td class="{{listado.sorbitolRojo}}"></td>
                <td class="{{listado.gosRojo}}"></td>
                <td class="{{listado.fructanoRojo}}"></td>
                <td>{{listado.grRojo}}</td>
            </tr>
            {% endif %}
        {% endif %}
    </tbody>
  </table>
</div>
   <!-- Imagen con los avisos -->
  <div class="row g-0 bg-light position-relative my-4">
      <img class="rounded col-md-10 col-lg-6 d-md-block" alt="dew" src="{% static 'Home/img/arroz-blanco.webp'%}">
    
    <div class="col-xs-12 col-md-10 col-lg-6 p-md-4">
      <h5 class="mt-0">No permitido</h5>
      <p>{{listado.commentRojo}} It is intended to mimic what some real-world content would look like, and we're using it here to give the component a bit of body and size.</p>
      
      <h5 class="mt-0">Alerta</h5>
      <p>{{listado.commentAmarillo}} It is intended to mimic what some real-world content would look like, and we're using it here to give the component a bit of body and size.</p>
  
      <h5 class="mt-0">Precaucion</h5>
      <p>{{listado.commentAmarillo}} It is intended to mimic what some real-world content would look like, and we're using it here to give the component a bit of body and size.</p>
      
    </div>
  </div>
  <!-- Si el usuario esta registrado puede guardar notas y valorar el alimento -->
  
  {% if user.is_authenticated %}
<div class="row col-md-6 mx-auto my-4">
  <div class="row m-auto">
      <!-- Seleccionar la cara -->
    {% if favoritos.valor == 1 %}
      <div class="col">
        <a><img id="mareado" src="{% static 'Home/img/face/005-mareado-5.png'%}" alt="icono-mareado"/></a>
        <a><img id="aburrido" src="{% static 'Home/img/face/001-aburrido.png'%}" alt="icono-aburrido"/></a>
        <a><img id="sonreir" src="{% static 'Home/img/face/003-sonreir.png'%}" alt="icono-sonreir"/></a>
      </div>    
    {% endif %}
    {% if favoritos.valor == 2 %}
    <div class="col">
      <a><img id="mareado"src="{% static 'Home/img/face/002-mareado.png'%}" alt="icono-mareado"/></a>
      <a><img id="aburrido"src="{% static 'Home/img/face/006-aburrido-6.png'%}" alt="icono-aburrido"/></a>
      <a><img id="sonreir"src="{% static 'Home/img/face/003-sonreir.png'%}" alt="icono-sonreir"/></a>
    </div>
    {% endif %}
    {% if favoritos.valor == 3 %}
    <div class="col">
      <a><img id="mareado" src="{% static 'Home/img/face/002-mareado.png'%}" alt="icono-mareado"/></a>
      <a><img id="aburrido" src="{% static 'Home/img/face/001-aburrido.png'%}" alt="icono-aburrido"/></a>
      <a><img id="sonreir" src="{% static 'Home/img/face/004-sonrer-4.png'%}" alt="icono-sonreir"/></a>
    </div>
    {% endif %}
    {% if favoritos.valor != 1 and favoritos.valor != 2 and favoritos.valor !=  3%}
      <a><img id="mareado" src="{% static 'Home/img/face/002-mareado.png'%}" alt="icono-mareado"/></a>
      <a><img id="aburrido"src="{% static 'Home/img/face/001-aburrido.png'%}" alt=icono-aburrido"/></a>
      <a><img id="sonreir" src="{% static 'Home/img/face/003-sonreir.png'%}" alt="icono-sonreir"/></a>
    {% endif %}
  </div>
</div>
 <!-- 
      Dejar comentario 
      Se envian datos ocultos para indentificar el alimento en servidor
-->
<table id="form_favoritos" action="" class="table">
  <tbody>
    <input type="hidden" id="id_producto" name="id_producto" value="{{ listado.id }}">
    <input type="hidden" id="name" name="name" value="{{ listado.name }}">
    <tr  class="row justify-content-md-center mx-5">
      <textarea class="form-control col-xs-12 col-md-9 m-md-auto" placeholder="Deja una nota..." name="comment" id="comment_favoritos">
        {{favoritos.comment}}
      </textarea>
    </tr>
  </tbody>
</table>
 <!-- Boton enviar -->
{% if favoritos %}
  <div class="row col-md-6 mx-auto">
    <button id="sub_update" class="btn btn-outline-primary m-auto " type="button">Actualizar</button>
  </div>
{% else %}
<div class="row col-md-6 mx-auto">
  <button id="sub" class="btn btn-outline-primary m-auto " type="button">Guardar</button>
</div>
{% endif %}
{% endif %}
<script>
// Cambiar color a las caras 
    let aburrido =  document.getElementById("aburrido");
    let mareado =  document.getElementById("mareado");
    let sonreir =  document.getElementById("sonreir");
    var num = 0;

// al hacer click se cambia la imagen
    aburrido.onclick = function(e){
      if(event.target.src.substr(-5) !== '6.png' && event.target.id == 'aburrido'){
        aburrido.setAttribute('src', "{% static 'Home/img/face/006-aburrido-6.png'%}");
        mareado.setAttribute('src', "{% static 'Home/img/face/002-mareado.png'%}");
        sonreir.setAttribute('src', "{% static 'Home/img/face/003-sonreir.png'%}");
        num = 2
      }else{
        aburrido.setAttribute('src', "{% static 'Home/img/face/001-aburrido.png'%}");
      num = 0
      }
      console.log(event.target.src.substr(-5));
      console.log(num)
    }   
    mareado.onclick = function(e){
  //Mareado
      if(event.target.src.substr(-5) !== '5.png' && event.target.id == 'mareado'){
         mareado.setAttribute('src', "{% static 'Home/img/face/005-mareado-5.png'%}");
         sonreir.setAttribute('src', "{% static 'Home/img/face/003-sonreir.png'%}");
         aburrido.setAttribute('src', "{% static 'Home/img/face/001-aburrido.png'%}");
          num = 1
       }else{
         mareado.setAttribute('src', "{% static 'Home/img/face/002-mareado.png'%}");
        num = 0
       }
       console.log(num)
    }

    sonreir.onclick = function(e){
  //Sonreir
      if(event.target.src.substr(-5) !== '4.png' && event.target.id == 'sonreir'){
         sonreir.setAttribute('src', "{% static 'Home/img/face/004-sonrer-4.png'%}");
         mareado.setAttribute('src', "{% static 'Home/img/face/002-mareado.png'%}");
         aburrido.setAttribute('src', "{% static 'Home/img/face/001-aburrido.png'%}");
          num = 3
       }else{
         sonreir.setAttribute('src', "{% static 'Home/img/face/003-sonreir.png'%}");
        num = 0
       }
       console.log(num)
      }
      
  //Guardar el alimento en la tabla Favoritos
    $("#sub").click(function(e){
        e.preventDefault();
        console.log('submit')
      let id_producto = $('input[name="id_producto"]').val().trim();
      let name = $('input[name="name"]').val().trim();
      let valor = num;
      let comment = $('#comment_favoritos').val().trim();
    
  //Peticion Ajax
        $.ajax({
            url: '/Favoritos/create-favoritos/',
            data: {
                'id_producto': id_producto,
                'name': name,
                'valor': valor,
                'comment': comment
            },
            dataType: 'json',
            success: function (data) {
              location.reload(); 
            }
        });
      
  });
  //Actualizar el alimento en la tabla Favoritos
  $("#sub_update").click(function(e){
         e.preventDefault();
         console.log('submit')
       let id_producto = $('input[name="id_producto"]').val().trim();
       let valor = num;
       let comment = $('#comment_favoritos').val().trim();
  //Peticion Ajax
         $.ajax({
             url: '/Favoritos/update-favoritos/',
             data: {
                 'id_producto': id_producto,
                 'valor': valor,
                 'comment': comment
             },
             dataType: 'json',
             success: function (data) {
  //Aviso cuando se actualizo el registro
              $('#alert').fadeIn();     
                setTimeout(function() {
                $("#alert").fadeOut();           
                },2000); 
             }
         });
   });
  </script> 
{% endblock %}